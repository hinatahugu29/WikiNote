# 📘 ポータブルWiki v1.1.0

PC間で持ち運び可能な、自動保存・自動バックアップ機能付きのWikiシステムです。

## ✨ 特徴

- 🚀 **ポータブル**: フォルダごと持ち運び可能（Node.jsのみ必要）
- 💾 **自動保存**: 編集内容を自動的にファイルに保存
- 📦 **自動バックアップ**: 保存のたびにタイムスタンプ付きバックアップを作成
- 🔄 **簡単移行**: データはJSONファイルで管理、どのPCでも同じ環境
- 🌐 **ブラウザベース**: お気に入りのブラウザで使用可能
- 📝 **Markdown対応**: GitHub Flavored Markdown、数式、コードハイライト対応
- ↔️ **HTML相互変換**: HTMLをペースト時に自動Markdown変換、プレビューでの編集をMarkdownに反映

## 🚀 はじめ方

### 初回セットアップ

1. **Node.jsのインストール**（まだの場合）
   - https://nodejs.org/ からダウンロード
   - LTS版を推奨

2. **依存関係のインストール**
   ```bash
   npm install
   ```

### 起動方法

**Windows:**
```bash
start.bat
```
（または `start.bat` をダブルクリック）

**Mac/Linux:**
```bash
chmod +x start.sh
./start.sh
```

サーバーが起動すると、自動的にブラウザで `http://localhost:3000` が開きます。

## 📁 ファイル構成

```
WikiPortable/
├── server.js              # Node.jsサーバー
├── package.json           # 依存関係定義
├── start.bat              # Windows起動スクリプト
├── start.sh               # Mac/Linux起動スクリプト
├── README.md              # このファイル
├── public/
│   ├── index.html         # Wikiフロントエンド
│   └── portable-patch.js  # サーバー連携パッチ
├── data/
│   └── wiki_data.json     # メインデータ
├── backups/               # 自動バックアップ
│   ├── auto_20260113_120000.json
│   └── auto_20260113_130000.json
└── node_modules/          # 依存パッケージ（自動生成）
```

## 💡 使い方

### 記事の作成・編集

1. 「＋ 新規作成」ボタンをクリック
2. タイトル、フォルダ、タグ、内容を入力
3. 「保存」ボタンをクリック → 自動的にサーバーに保存され、バックアップが作成されます

### バックアップ管理

ヘッダーの「📦 バックアップ管理」をクリック
- バックアップ一覧の表示
- 過去の状態に復元
- 不要なバックアップの削除

### 自動バックアップ

- 保存のたびに `backups/` フォルダに自動バックアップ作成
- ファイル名: `auto_YYYYMMDD_HHMMSS.json`
- 最大30個まで自動保持（古いものから自動削除）

## 🔄 PC間での移行方法

1. **エクスポート（元のPC）**
   ```bash
   # WikiPortableフォルダをまるごとコピー
   # USBメモリ、クラウドストレージ、ネットワークドライブなど
   ```

2. **インポート（新しいPC）**  
   ```bash
   # コピーしたWikiPortableフォルダに移動
   cd WikiPortable
   
   # 依存関係をインストール
   npm install
   
   # 起動
   start.bat  # Windows
   ./start.sh # Mac/Linux
   ```

これだけで、全てのデータと設定がそのまま引き継がれます！

## 🔄 他環境からのバックアップインポート

旧バージョンのWikiや別のPCで作成したバックアップ（JSONファイル）をインポートできます。

### 方法1: backupsフォルダ経由（推奨）

最も安全な方法です：

1. バックアップJSONファイルを `backups/` フォルダにコピー
   ```bash
   copy 旧環境のバックアップ.json WikiPortable\backups\
   ```

2. Wikiを開いて「📦 バックアップ管理」をクリック

3. コピーしたファイルが一覧に表示されるので「復元」をクリック

### 方法2: 直接上書き

現在のデータを完全に置き換える場合：

1. サーバーを停止（ターミナルで `Ctrl+C`）
2. ファイルを上書き
   ```bash
   copy 旧環境のバックアップ.json WikiPortable\data\wiki_data.json
   ```
3. サーバーを再起動（`start.bat`）

### 方法3: 手動マージ

両方のデータを統合したい場合、JSONエディタで編集（上級者向け）：

```json
[
  // 現在の記事
  { "id": 1, "title": "記事1", ... },
  
  // 旧環境の記事を追加
  { "id": 2, "title": "旧記事1", ... }
]
```

## 🎉 バックアップの追加（マージ）

バックアップ管理画面から、以下の操作が可能になりました：

1. **➕ 追加（緑）**: バックアップの内容を現在のデータに追加（ID衝突は自動解決）
2. **🔄 復元（青）**: 現在のデータをバックアップの内容で完全に置き換え
3. **🗑️ 削除（赤）**: 不要なバックアップを削除

### マージ機能の特徴
- **IDの自動解決**: 同じIDがある場合は新しいIDが割り当てられます
- **タイトルの重複**: 同じタイトルがある場合「(インポート)」が付加されます
- **件数通知**: 追加された記事数が表示されます

## 🛠️ データのバックアップ

### 自動バックアップ

保存時に自動的に作成されます。手動操作は不要です。

### 手動バックアップ（追加の安全性のため）

**方法1: フォルダごとコピー**
```bash
# WikiPortableフォルダをまるごと別の場所にコピー
```

**方法2: dataフォルダのみコピー**
```bash
# data/wiki_data.json をコピー
```

**方法3: クラウド同期**
```bash
# WikiPortableフォルダをOneDrive、Dropbox、Google Driveなどに配置
```

## 🎯 よくある質問

### Q: Node.jsは必須ですか？
A: はい。サーバーを動かすために必要です。Node.js 14以降を推奨します。

### Q: インターネット接続は必要ですか？
A: 不要です。完全にローカルで動作します。（初回のnpm installのみ必要）

### Q: データはどこに保存されますか？
A: `data/wiki_data.json` にJSONファイルとして保存されます。

### Q: 旧バージョンのデータを移行できますか？
A: はい。旧バージョンのlocalStorageデータをエクスポートし、バックアップ管理から復元できます。

### Q: バックアップはどれくらいの頻度で作成されますか？
A: 保存ボタンを押すたびに自動作成されます。

### Q: サーバーを停止するには？
A: ターミナルで `Ctrl+C` を押します。

## 🔒 セキュリティ

- サーバーは `localhost` のみでリッスン（外部からアクセス不可）
- データは全てローカルに保存
- 外部への通信は一切なし

## 📝 ライセンス

MIT License - 自由に使用・改変・配布可能

## 🙏 サポート

問題が発生した場合は、以下を確認してください：
1. Node.jsが正しくインストールされているか
2. `npm install` が正常に完了したか
3. ポート3000が他のアプリケーションで使用されていないか

---

**Enjoy your portable wiki! 📘✨**
